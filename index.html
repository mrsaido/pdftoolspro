<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pdf tools pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    <style>
        .dropzone {
            border: 2px dashed #3b82f6;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        .dropzone.active {
            border-color: #10b981;
            background-color: #f0f9ff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .signature-preview {
            border: 1px solid #e5e7eb;
            background-color: #f9fafb;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .progress-bar {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #3b82f6;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="max-w-6xl mx-auto p-6">
        <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-t-3xl text-center shadow-md">
            <h1 class="text-4xl font-bold mb-2">Outils PDF Pro</h1>
            <p class="text-lg">Divisez, fusionnez et g√©rez vos fichiers PDF facilement</p>
        </div>
    </header>

    <!-- Contenu principal -->
    <main class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <!-- Onglets -->
            <div class="flex border-b">
                <button class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-300 transition" data-tab="merge">
                    <i class="fas fa-object-group mr-2"></i> Fusionner des PDF
              </button>
                <button class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-300 transition" data-tab="extract">
                    <i class="fas fa-cut mr-2"></i> Extraire des pages
                </button>
               <button class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-300 transition" data-tab="add-logo">
				<i class="fas fa-image mr-2"></i> Ajouter un logo
				</button>

            </div>

            <!-- Contenu des onglets -->
            <div class="p-6">
                <!-- Fusionner des PDF -->
                <div id="merge" class="tab-content active">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Fusionner plusieurs fichiers PDF en un seul</h2>
                    <div class="dropzone p-8 mb-4 text-center cursor-pointer" id="merge-dropzone">
                        <i class="fas fa-cloud-upload-alt text-4xl text-blue-500 mb-2"></i>
                        <p class="text-gray-600">Glissez-d√©posez vos fichiers PDF ici ou cliquez pour s√©lectionner</p>
                        <input type="file" id="merge-files" class="hidden" accept=".pdf" multiple>
                    </div>
                    <div id="merge-file-list" class="mb-4 space-y-2"></div>
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" id="merge-number-pages" class="mr-2">
                                <span class="text-gray-700">Num√©roter les pages</span>
                            </label>
                        </div>
                        <button id="merge-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-object-group mr-2"></i> Fusionner les PDF
                        </button>
                    </div>
                    <div id="merge-progress" class="hidden">
                        <div class="mb-2 text-sm text-gray-600">Traitement en cours...</div>
                        <div class="progress-bar">
                            <div id="merge-progress-fill" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>


               <!-- Extraire des pages -->
<div id="extract" class="tab-content">
    <h2 class="text-xl font-semibold mb-4 text-gray-800">Extraire des pages d‚Äôun fichier PDF</h2>
    <div class="dropzone p-8 mb-4 text-center cursor-pointer" id="extract-dropzone">
        <i class="fas fa-cloud-upload-alt text-4xl text-blue-500 mb-2"></i>
        <p class="text-gray-600">Glissez-d√©posez un fichier PDF ici ou cliquez pour s√©lectionner</p>
        <input type="file" id="extract-file" class="hidden" accept=".pdf">
    </div>
    <div id="extract-file-info" class="hidden mb-4 p-3 bg-gray-50 rounded-md">
        <div class="flex justify-between items-center">
            <span class="font-medium text-gray-700" id="extract-file-name"></span>
            <span class="text-sm text-gray-500" id="extract-page-count"></span>
        </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Plage de pages</label>
            <input type="text" id="extract-range" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex : 1-3, 5, 7-9">
            <p class="text-xs text-gray-500 mt-1">S√©parez les plages (1-3) ou pages individuelles (5) avec des virgules</p>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Ou s√©lectionnez les pages</label>
            <div id="extract-page-selector" class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 border border-gray-300 rounded-md"></div>
        </div>
    </div>
    <div class="flex justify-end">
        <button id="extract-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fas fa-cut mr-2"></i> Extraire les pages
        </button>
    </div>
    <div id="extract-progress" class="hidden mt-4">
        <div class="mb-2 text-sm text-gray-600">Traitement en cours...</div>
        <div class="progress-bar">
            <div id="extract-progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
    </div>
</div>



<!-- ajouter logo -->
<div id="add-logo" class="tab-content">
    <h2 class="text-xl font-semibold mb-4 text-gray-800">Ajouter un logo √† un PDF</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">S√©lectionner un PDF</label>
            <div class="dropzone p-8 text-center cursor-pointer" id="logo-pdf-dropzone">
                <i class="fas fa-file-pdf text-4xl text-red-500 mb-2"></i>
                <p class="text-gray-600">Glissez-d√©posez un PDF ici</p>
                <input type="file" id="logo-pdf-input" class="hidden" accept=".pdf">
            </div>
            <div id="logo-pdf-info" class="hidden mt-2 p-3 bg-gray-50 rounded-md border border-gray-200">
                <div class="flex justify-between items-start">
                    <div class="flex items-center truncate">
                        <i class="fas fa-file-pdf text-red-500 mr-2"></i>
                        <div>
                            <span id="logo-pdf-name" class="text-sm font-medium block truncate"></span>
                            <span id="logo-pdf-size" class="text-xs text-gray-500"></span>
                        </div>
                    </div>
                    <button id="logo-pdf-reset" class="text-gray-400 hover:text-red-500 ml-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="logo-pdf-pages" class="text-xs text-gray-500 mt-1"></div>
            </div>
        </div>
        
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">S√©lectionner un logo</label>
            <div class="dropzone p-8 text-center cursor-pointer" id="logo-image-dropzone">
                <i class="fas fa-image text-4xl text-blue-500 mb-2"></i>
                <p class="text-gray-600">Glissez-d√©posez une image (PNG/JPG) ici</p>
                <input type="file" id="logo-image-input" class="hidden" accept="image/*">
            </div>
            <div id="logo-image-info" class="hidden mt-2 p-3 bg-gray-50 rounded-md border border-gray-200">
                <div class="flex justify-between items-start">
                    <div class="flex items-center truncate">
                        <i class="fas fa-image text-blue-500 mr-2"></i>
                        <div>
                            <span id="logo-image-name" class="text-sm font-medium block truncate"></span>
                            <span id="logo-image-size" class="text-xs text-gray-500"></span>
                        </div>
                    </div>
                    <button id="logo-image-reset" class="text-gray-400 hover:text-red-500 ml-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="logo-image-preview-container" class="mt-2 flex justify-center">
                    <img id="logo-image-preview" class="max-h-20 max-w-full border border-gray-200 rounded">
                </div>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Position du logo</label>
            <select id="logo-position" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="top-left">Haut gauche</option>
                <option value="top-right">Haut droit</option>
                <option value="center" selected>Centr√© en haut</option>
                <option value="bottom-left">Bas gauche</option>
                <option value="bottom-right">Bas droit</option>
                <option value="bottom-center">Centr√© en bas</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Taille du logo</label>
            <div class="flex items-center">
                <input type="range" id="logo-scale" min="5" max="50" value="15" class="w-full mr-3">
                <span id="logo-scale-value" class="text-sm w-12 text-center">15%</span>
            </div>
        </div>
    </div>
    
    <div class="flex justify-between items-center">
        <button id="reset-all-btn" class="text-gray-600 hover:text-red-500 text-sm flex items-center">
            <i class="fas fa-redo mr-1"></i> Tout r√©initialiser
        </button>
        <button id="add-logo-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fas fa-plus-circle mr-2"></i> Ajouter le logo
        </button>
    </div>
    
    <div id="add-logo-progress" class="hidden mt-4">
        <div class="mb-2 text-sm text-gray-600">Traitement en cours...</div>
        <div class="progress-bar">
            <div id="add-logo-progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
    </div>
</div>




    <script>
	
	//img script 
	// Remplacer le code JavaScript pour la section "add-logo" par ceci

// Gestion de l'onglet Ajouter un logo
const logoPdfDropzone = document.getElementById('logo-pdf-dropzone');
const logoPdfInput = document.getElementById('logo-pdf-input');
const logoPdfInfo = document.getElementById('logo-pdf-info');
const logoPdfName = document.getElementById('logo-pdf-name');
const logoPdfSize = document.getElementById('logo-pdf-size');
const logoPdfPages = document.getElementById('logo-pdf-pages');
const logoPdfReset = document.getElementById('logo-pdf-reset');

const logoImageDropzone = document.getElementById('logo-image-dropzone');
const logoImageInput = document.getElementById('logo-image-input');
const logoImageInfo = document.getElementById('logo-image-info');
const logoImageName = document.getElementById('logo-image-name');
const logoImageSize = document.getElementById('logo-image-size');
const logoImagePreview = document.getElementById('logo-image-preview');
const logoImageReset = document.getElementById('logo-image-reset');

const logoPosition = document.getElementById('logo-position');
const logoScale = document.getElementById('logo-scale');
const logoScaleValue = document.getElementById('logo-scale-value');
const addLogoBtn = document.getElementById('add-logo-btn');
const resetAllBtn = document.getElementById('reset-all-btn');
const addLogoProgress = document.getElementById('add-logo-progress');
const addLogoProgressFill = document.getElementById('add-logo-progress-fill');

let logoPdfFile = null;
let logoImageFile = null;

// Mise √† jour de la valeur du scale
logoScale.addEventListener('input', () => {
    logoScaleValue.textContent = `${logoScale.value}%`;
});

// Gestion des dropzones
logoPdfDropzone.addEventListener('click', () => logoPdfInput.click());
logoPdfDropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    logoPdfDropzone.classList.add('active');
});
logoPdfDropzone.addEventListener('dragleave', () => {
    logoPdfDropzone.classList.remove('active');
});
logoPdfDropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    logoPdfDropzone.classList.remove('active');
    handleLogoPdfFile(e.dataTransfer.files[0]);
});

logoImageDropzone.addEventListener('click', () => logoImageInput.click());
logoImageDropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    logoImageDropzone.classList.add('active');
});
logoImageDropzone.addEventListener('dragleave', () => {
    logoImageDropzone.classList.remove('active');
});
logoImageDropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    logoImageDropzone.classList.remove('active');
    handleLogoImageFile(e.dataTransfer.files[0]);
});

logoPdfInput.addEventListener('change', () => {
    if (logoPdfInput.files.length > 0) {
        handleLogoPdfFile(logoPdfInput.files[0]);
    }
});

logoImageInput.addEventListener('change', () => {
    if (logoImageInput.files.length > 0) {
        handleLogoImageFile(logoImageInput.files[0]);
    }
});

// Boutons de r√©initialisation
logoPdfReset.addEventListener('click', (e) => {
    e.stopPropagation();
    resetPdfFile();
});

logoImageReset.addEventListener('click', (e) => {
    e.stopPropagation();
    resetImageFile();
});

resetAllBtn.addEventListener('click', () => {
    resetPdfFile();
    resetImageFile();
});

function resetPdfFile() {
    logoPdfFile = null;
    logoPdfInput.value = '';
    logoPdfInfo.classList.add('hidden');
    updateAddLogoBtnState();
}

function resetImageFile() {
    logoImageFile = null;
    logoImageInput.value = '';
    logoImageInfo.classList.add('hidden');
    updateAddLogoBtnState();
}

async function handleLogoPdfFile(file) {
    if (file.type !== 'application/pdf') {
        alert('Veuillez s√©lectionner un fichier PDF');
        return;
    }
    
    logoPdfFile = file;
    
    // Afficher les informations du fichier
    logoPdfName.textContent = file.name;
    logoPdfSize.textContent = formatFileSize(file.size);
    
    try {
        // Obtenir le nombre de pages
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        const pageCount = pdfDoc.getPageCount();
        logoPdfPages.textContent = `${pageCount} page${pageCount > 1 ? 's' : ''}`;
    } catch (error) {
        console.error("Erreur lors de la lecture du PDF:", error);
        logoPdfPages.textContent = "Nombre de pages inconnu";
    }
    
    logoPdfInfo.classList.remove('hidden');
    updateAddLogoBtnState();
}

function handleLogoImageFile(file) {
    if (!file.type.includes('image')) {
        alert('Veuillez s√©lectionner une image (PNG ou JPG)');
        return;
    }
    
    logoImageFile = file;
    
    // Afficher les informations du fichier
    logoImageName.textContent = file.name;
    logoImageSize.textContent = formatFileSize(file.size);
    
    // Afficher l'aper√ßu de l'image
    const reader = new FileReader();
    reader.onload = (e) => {
        logoImagePreview.src = e.target.result;
    };
    reader.readAsDataURL(file);
    
    logoImageInfo.classList.remove('hidden');
    updateAddLogoBtnState();
}

function updateAddLogoBtnState() {
    addLogoBtn.disabled = !(logoPdfFile && logoImageFile);
}

// Fonction pour ajouter le logo
addLogoBtn.addEventListener('click', async () => {
    if (!logoPdfFile || !logoImageFile) return;
    
    addLogoProgress.classList.remove('hidden');
    addLogoProgressFill.style.width = '0%';
    
    try {
        const pdfBytes = await logoPdfFile.arrayBuffer();
        const logoBytes = await logoImageFile.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);

        let logoImage;
        const fileType = logoImageFile.type;
        if (fileType.includes("png")) {
            logoImage = await pdfDoc.embedPng(logoBytes);
        } else if (fileType.includes("jpeg") || fileType.includes("jpg")) {
            logoImage = await pdfDoc.embedJpg(logoBytes);
        } else {
            alert("Format d'image non support√©. Utilisez PNG ou JPG.");
            return;
        }

        const pages = pdfDoc.getPages();
        const scalePercent = parseInt(logoScale.value);
        
        for (const page of pages) {
            const { width, height } = page.getSize();
            const logoWidth = (width * scalePercent) / 100;
            const logoHeight = (logoImage.height / logoImage.width) * logoWidth;

            let x = 0, y = 0;
            const position = logoPosition.value;
            const margin = 20; // marge de 20 points

            switch (position) {
                case 'top-left':
                    x = margin;
                    y = height - logoHeight - margin;
                    break;
                case 'top-right':
                    x = width - logoWidth - margin;
                    y = height - logoHeight - margin;
                    break;
                case 'center':
                    x = (width - logoWidth) / 2;
                    y = height - logoHeight - margin;
                    break;
                case 'bottom-left':
                    x = margin;
                    y = margin;
                    break;
                case 'bottom-right':
                    x = width - logoWidth - margin;
                    y = margin;
                    break;
                case 'bottom-center':
                    x = (width - logoWidth) / 2;
                    y = margin;
                    break;
            }

            page.drawImage(logoImage, {
                x,
                y,
                width: logoWidth,
                height: logoHeight,
            });
        }

        addLogoProgressFill.style.width = '80%';
        
        const newPdfBytes = await pdfDoc.save();
        const pdfBlob = new Blob([newPdfBytes], { type: 'application/pdf' });
        
        const fileName = `document_avec_logo_${new Date().toISOString().slice(0, 10)}.pdf`;
        download(pdfBlob, fileName, 'application/pdf');
        
        addLogoProgressFill.style.width = '100%';
        setTimeout(() => {
            addLogoProgress.classList.add('hidden');
        }, 500);
        
    } catch (error) {
        console.error('Erreur lors de l\'ajout du logo:', error);
        addLogoProgress.classList.add('hidden');
        alert('Une erreur est survenue lors de l\'ajout du logo');
    }
});

// Fonction pour formater la taille des fichiers
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}
 

	//img script
        // Manejo de pesta√±as
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');
                
                // Desactivar todas las pesta√±as
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('border-blue-600', 'text-blue-600');
                    b.classList.add('border-transparent', 'text-gray-600');
                });
                
                // Activar la pesta√±a seleccionada
                btn.classList.remove('border-transparent', 'text-gray-600');
                btn.classList.add('border-blue-600', 'text-blue-600');
                
                // Ocultar todos los contenidos
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Mostrar el contenido seleccionado
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Funcionalidad para Unir PDFs
        const mergeDropzone = document.getElementById('merge-dropzone');
        const mergeFilesInput = document.getElementById('merge-files');
        const mergeFileList = document.getElementById('merge-file-list');
        const mergeBtn = document.getElementById('merge-btn');
        const mergeProgress = document.getElementById('merge-progress');
        const mergeProgressFill = document.getElementById('merge-progress-fill');

        let mergeFiles = [];

        mergeDropzone.addEventListener('click', () => mergeFilesInput.click());
        mergeDropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            mergeDropzone.classList.add('active');
        });
        mergeDropzone.addEventListener('dragleave', () => {
            mergeDropzone.classList.remove('active');
        });
        mergeDropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            mergeDropzone.classList.remove('active');
            handleMergeFiles(e.dataTransfer.files);
        });

        mergeFilesInput.addEventListener('change', () => {
            handleMergeFiles(mergeFilesInput.files);
        });

        function handleMergeFiles(files) {
            mergeFiles = [];
            mergeFileList.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.type === 'application/pdf') {
                    mergeFiles.push(file);
                    
                    const fileItem = document.createElement('div');
                    fileItem.className = 'flex items-center justify-between p-2 bg-gray-50 rounded-md';
                    fileItem.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-file-pdf text-red-500 mr-2"></i>
                            <span class="text-sm">${file.name}</span>
                        </div>
                        <span class="text-xs text-gray-500">${formatFileSize(file.size)}</span>
                    `;
                    mergeFileList.appendChild(fileItem);
                }
            }
            
            mergeBtn.disabled = mergeFiles.length < 2;
        }

        mergeBtn.addEventListener('click', async () => {
            if (mergeFiles.length < 2) return;
            
            mergeProgress.classList.remove('hidden');
            mergeProgressFill.style.width = '0%';
            
            try {
                // Crear un nuevo PDF
                const { PDFDocument } = PDFLib;
                const mergedPdf = await PDFDocument.create();
                
                let progress = 0;
                const progressIncrement = 100 / mergeFiles.length;
                
                // Procesar cada archivo PDF
                for (const file of mergeFiles) {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFDocument.load(arrayBuffer);
                    
                    // Copiar p√°ginas al PDF final
                    const pages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                    pages.forEach(page => mergedPdf.addPage(page));
                    
                    // Actualizar progreso
                    progress += progressIncrement;
                    mergeProgressFill.style.width = `${Math.min(progress, 100)}%`;
                }
                
                // Guardar el PDF unido
                const mergedPdfBytes = await mergedPdf.save();
                const mergedPdfBlob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                
                // Descargar el PDF
                const mergedName = `documento_unido_${new Date().toISOString().slice(0, 10)}.pdf`;
                download(mergedPdfBlob, mergedName, 'application/pdf');
                
                mergeProgress.classList.add('hidden');
                mergeFiles = [];
                mergeFileList.innerHTML = '';
                mergeBtn.disabled = true;
                
            } catch (error) {
                console.error('Error al unir PDFs:', error);
                mergeProgress.classList.add('hidden');
                alert('Ocurri√≥ un error al unir los PDFs');
            }
        });

        // Funcionalidad para Extraer p√°ginas
        const extractDropzone = document.getElementById('extract-dropzone');
        const extractFileInput = document.getElementById('extract-file');
        const extractFileInfo = document.getElementById('extract-file-info');
        const extractFileName = document.getElementById('extract-file-name');
        const extractPageCount = document.getElementById('extract-page-count');
        const extractRange = document.getElementById('extract-range');
        const extractPageSelector = document.getElementById('extract-page-selector');
        const extractBtn = document.getElementById('extract-btn');
        const extractProgress = document.getElementById('extract-progress');
        const extractProgressFill = document.getElementById('extract-progress-fill');

        let extractFile = null;
        let totalPages = 0;

        extractDropzone.addEventListener('click', () => extractFileInput.click());
        extractDropzone.addEventListener('dragoover', (e) => {
            e.preventDefault();
            extractDropzone.classList.add('active');
        });
        extractDropzone.addEventListener('dragleave', () => {
            extractDropzone.classList.remove('active');
        });
        extractDropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            extractDropzone.classList.remove('active');
            handleExtractFile(e.dataTransfer.files[0]);
        });

        extractFileInput.addEventListener('change', () => {
            if (extractFileInput.files.length > 0) {
                handleExtractFile(extractFileInput.files[0]);
            }
        });

        async function handleExtractFile(file) {
            if (file.type !== 'application/pdf') {
                alert('Por favor, selecciona un archivo PDF');
                return;
            }
            
            extractFile = file;
            extractFileName.textContent = file.name;
            
            try {
                // Obtener el n√∫mero real de p√°ginas del PDF
                const arrayBuffer = await file.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                totalPages = pdfDoc.getPageCount();
                
                extractPageCount.textContent = `${totalPages} pages`;
                
                // Generar botones de selecci√≥n de p√°ginas
                extractPageSelector.innerHTML = '';
                for (let i = 1; i <= totalPages; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = 'px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded';
                    pageBtn.textContent = i;
                    pageBtn.dataset.page = i;
                    pageBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        pageBtn.classList.toggle('bg-blue-100', !pageBtn.classList.contains('bg-blue-100'));
                        pageBtn.classList.toggle('text-blue-700', !pageBtn.classList.contains('text-blue-700'));
                        updateExtractRange();
                    });
                    extractPageSelector.appendChild(pageBtn);
                }
                
                extractFileInfo.classList.remove('hidden');
                extractBtn.disabled = false;
                
            } catch (error) {
                console.error('Error al cargar PDF:', error);
                alert('No se pudo cargar el archivo PDF');
            }
        }

        function updateExtractRange() {
            const selectedPages = Array.from(extractPageSelector.querySelectorAll('.bg-blue-100'))
                .map(btn => parseInt(btn.dataset.page))
                .sort((a, b) => a - b);
            
            if (selectedPages.length === 0) {
                extractRange.value = '';
                return;
            }
            
            // Convertir a rangos (ej: 1,2,3,5,6,7 -> 1-3,5-7)
            let ranges = [];
            let start = selectedPages[0];
            let prev = start;
            
            for (let i = 1; i < selectedPages.length; i++) {
                if (selectedPages[i] === prev + 1) {
                    prev = selectedPages[i];
                } else {
                    ranges.push(start === prev ? start : `${start}-${prev}`);
                    start = selectedPages[i];
                    prev = start;
                }
            }
            ranges.push(start === prev ? start : `${start}-${prev}`);
            
            extractRange.value = ranges.join(', ');
        }

        extractRange.addEventListener('input', () => {
            // Limpiar selecci√≥n de botones
            extractPageSelector.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'text-blue-700');
            });
            
            // Procesar el rango ingresado
            const ranges = extractRange.value.split(',').map(r => r.trim());
            
            for (const range of ranges) {
                if (range.includes('-')) {
                    const [start, end] = range.split('-').map(n => parseInt(n));
                    if (!isNaN(start) && !isNaN(end) && start <= end && start >= 1 && end <= totalPages) {
                        for (let i = start; i <= end; i++) {
                            const btn = extractPageSelector.querySelector(`button[data-page="${i}"]`);
                            if (btn) {
                                btn.classList.add('bg-blue-100', 'text-blue-700');
                            }
                        }
                    }
                } else {
                    const page = parseInt(range);
                    if (!isNaN(page) && page >= 1 && page <= totalPages) {
                        const btn = extractPageSelector.querySelector(`button[data-page="${page}"]`);
                        if (btn) {
                            btn.classList.add('bg-blue-100', 'text-blue-700');
                        }
                    }
                }
            }
        });

        extractBtn.addEventListener('click', async () => {
            if (!extractFile) return;
            
            extractProgress.classList.remove('hidden');
            extractProgressFill.style.width = '0%';
            
            try {
                // Obtener las p√°ginas seleccionadas
                const selectedPages = Array.from(extractPageSelector.querySelectorAll('.bg-blue-100'))
                    .map(btn => parseInt(btn.dataset.page) - 1); // pdf-lib usa √≠ndices base 0
                
                if (selectedPages.length === 0) {
                    alert('Por favor, selecciona al menos una p√°gina');
                    extractProgress.classList.add('hidden');
                    return;
                }
                
                // Cargar el PDF original
                const arrayBuffer = await extractFile.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                
                // Crear un nuevo PDF con las p√°ginas seleccionadas
                const newPdf = await PDFLib.PDFDocument.create();
                const pages = await newPdf.copyPages(pdfDoc, selectedPages);
                pages.forEach(page => newPdf.addPage(page));
                
                // Guardar el nuevo PDF
                const pdfBytes = await newPdf.save();
                const pdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
                
                // Descargar el PDF
                const extractedName = `paginas_extraidas_${new Date().toISOString().slice(0, 10)}.pdf`;
                download(pdfBlob, extractedName, 'application/pdf');
                
                extractProgressFill.style.width = '100%';
                setTimeout(() => {
                    extractProgress.classList.add('hidden');
                }, 500);
                
            } catch (error) {
                console.error('Error al extraer p√°ginas:', error);
                extractProgress.classList.add('hidden');
                alert('Ocurri√≥ un error al extraer las p√°ginas');
            }
        });


        // Eventos para dibujar en el canvas
        signatureCanvas.addEventListener('mousedown', startDrawing);
        signatureCanvas.addEventListener('touchstart', startDrawing);
        signatureCanvas.addEventListener('mousemove', draw);
        signatureCanvas.addEventListener('touchmove', draw);
        signatureCanvas.addEventListener('mouseup', stopDrawing);
        signatureCanvas.addEventListener('touchend', stopDrawing);
        signatureCanvas.addEventListener('mouseout', stopDrawing);

        function startDrawing(e) {
            isDrawing = true;
            const pos = getPosition(e);
            lastX = pos.x;
            lastY = pos.y;
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const pos = getPosition(e);
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            
            lastX = pos.x;
            lastY = pos.y;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function getPosition(e) {
            const rect = signatureCanvas.getBoundingClientRect();
            return {
                x: (e.clientX || e.touches[0].clientX) - rect.left,
                y: (e.clientY || e.touches[0].clientY) - rect.top
            };
        }

        // Manejo de archivo PDF para firmar
        signDropzone.addEventListener('click', () => signFileInput.click());
        signDropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            signDropzone.classList.add('active');
        });
        signDropzone.addEventListener('dragleave', () => {
            signDropzone.classList.remove('active');
        });
        signDropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            signDropzone.classList.remove('active');
            handleSignFile(e.dataTransfer.files[0]);
        });

        signFileInput.addEventListener('change', () => {
            if (signFileInput.files.length > 0) {
                handleSignFile(signFileInput.files[0]);
            }
        });

        async function handleSignFile(file) {
            if (file.type !== 'application/pdf') {
                alert('Por favor, selecciona un archivo PDF');
                return;
            }
            
            signFile = file;
            signFileName.textContent = file.name;
            
            try {
                // Obtener el n√∫mero real de p√°ginas del PDF
                const arrayBuffer = await file.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                const pages = pdfDoc.getPageCount();
                
                signPageCount.textContent = `${pages} p√°ginas`;
                
                // Actualizar opci√≥n de p√°gina personalizada
                signCustomPage.max = pages;
                
                signFileInfo.classList.remove('hidden');
                signPage.disabled = false;
                updateSignBtnState();
                
            } catch (error) {
                console.error('Error al cargar PDF:', error);
                alert('No se pudo cargar el archivo PDF');
            }
        }

        // Manejo de selecci√≥n de p√°gina
        signPage.addEventListener('change', () => {
            if (signPage.value === 'custom') {
                signCustomPageContainer.classList.remove('hidden');
            } else {
                signCustomPageContainer.classList.add('hidden');
            }
        });

        // Manejo de firma (subir imagen)
        signUploadBtn.addEventListener('click', () => signImageInput.click());
        signImageInput.addEventListener('change', () => {
            if (signImageInput.files.length > 0) {
                const file = signImageInput.files[0];
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    signatureImage = e.target.result;
                    signaturePreview.innerHTML = `<img src="${signatureImage}" alt="Firma" class="max-w-full max-h-32">`;
                    updateSignBtnState();
                };
                
                reader.readAsDataURL(file);
            }
        });

        // Manejo de firma (dibujar)
        signDrawBtn.addEventListener('click', () => {
            setupCanvas();
            drawModal.classList.remove('hidden');
        });

        clearSignature.addEventListener('click', () => {
            ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);
        });

        cancelSignature.addEventListener('click', () => {
            drawModal.classList.add('hidden');
        });

        saveSignature.addEventListener('click', () => {
            const dataUrl = signatureCanvas.toDataURL('image/png');
            signatureImage = dataUrl;
            signaturePreview.innerHTML = `<img src="${dataUrl}" alt="Firma dibujada" class="max-w-full max-h-32">`;
            drawModal.classList.add('hidden');
            updateSignBtnState();
        });

        // Manejo de firma (e-Token)
        signTokenBtn.addEventListener('click', () => {
            tokenModal.classList.remove('hidden');
        });

        cancelToken.addEventListener('click', () => {
            tokenModal.classList.add('hidden');
        });

        confirmToken.addEventListener('click', () => {
            const cert = document.getElementById('token-certificate').value;
            const password = document.getElementById('token-password').value;
            
            if (!cert || !password) {
                alert('Por favor, selecciona un certificado e ingresa la contrase√±a');
                return;
            }
            
            // Simular firma con token
            signatureImage = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMTAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjEwMCIgeT0iNTUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzAwMCI+RmlybWEgRGlnaXRhbDwvdGV4dD48L3N2Zz4=';
            signaturePreview.innerHTML = `<img src="${signatureImage}" alt="Firma digital" class="max-w-full max-h-32">`;
            
            tokenModal.classList.add('hidden');
            updateSignBtnState();
        });

        // Actualizar estado del bot√≥n de firma
        function updateSignBtnState() {
            signBtn.disabled = !(signFile && signatureImage);
        }

        // Firmar documento
        signBtn.addEventListener('click', async () => {
            if (!signFile || !signatureImage) return;
            
            signProgress.classList.remove('hidden');
            signProgressFill.style.width = '0%';
            
            try {
                // Cargar el PDF original
                const arrayBuffer = await signFile.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                
                // Determinar qu√© p√°ginas firmar
                let pagesToSign = [];
                const pageOption = signPage.value;
                
                if (pageOption === 'first') {
                    pagesToSign = [0];
                } else if (pageOption === 'last') {
                    pagesToSign = [pdfDoc.getPageCount() - 1];
                } else if (pageOption === 'all') {
                    pagesToSign = Array.from({ length: pdfDoc.getPageCount() }, (_, i) => i);
                } else if (pageOption === 'custom') {
                    const customPage = parseInt(signCustomPage.value) - 1; // Convertir a √≠ndice base 0
                    if (customPage >= 0 && customPage < pdfDoc.getPageCount()) {
                        pagesToSign = [customPage];
                    } else {
                        throw new Error('N√∫mero de p√°gina inv√°lido');
                    }
                }
                
                // Cargar la imagen de firma
                let signatureImageBytes;
                if (signatureImage.startsWith('data:image/svg')) {
                    // Usar la firma SVG del token (simulaci√≥n)
                    signatureImageBytes = await fetch(signatureImage).then(res => res.arrayBuffer());
                } else {
                    // Convertir imagen de firma a bytes
                    const response = await fetch(signatureImage);
                    signatureImageBytes = await response.arrayBuffer();
                }
                
                // Embed la imagen en el PDF
                let signatureImageObj;
                if (signatureImage.includes('png')) {
                    signatureImageObj = await pdfDoc.embedPng(signatureImageBytes);
                } else if (signatureImage.includes('jpeg') || signatureImage.includes('jpg')) {
                    signatureImageObj = await pdfDoc.embedJpg(signatureImageBytes);
                } else {
                    // Intentar como PNG por defecto
                    signatureImageObj = await pdfDoc.embedPng(signatureImageBytes);
                }
                
                const sizeFactor = signSize.value / 100;
                const signatureDims = signatureImageObj.scale(sizeFactor);
                
                // Aplicar firma a cada p√°gina seleccionada
                for (const pageIndex of pagesToSign) {
                    const page = pdfDoc.getPage(pageIndex);
                    const { width, height } = page.getSize();
                    
                    // Determinar posici√≥n seg√∫n selecci√≥n
                    let x, y;
                    const position = signPosition.value;
                    
                    // Margen de 20 puntos desde los bordes
                    const margin = 20;
                    
                    if (position === 'bottom-right') {
                        x = width - signatureDims.width - margin;
                        y = margin;
                    } else if (position === 'bottom-left') {
                        x = margin;
                        y = margin;
                    } else if (position === 'top-right') {
                        x = width - signatureDims.width - margin;
                        y = height - signatureDims.height - margin;
                    } else if (position === 'top-left') {
                        x = margin;
                        y = height - signatureDims.height - margin;
                    } else { // center
                        x = (width - signatureDims.width) / 2;
                        y = (height - signatureDims.height) / 2;
                    }
                    
                    // Dibujar firma
                    page.drawImage(signatureImageObj, {
                        x,
                        y,
                        width: signatureDims.width,
                        height: signatureDims.height,
                    });
                }
                
                // Actualizar progreso
                signProgressFill.style.width = '80%';
                
                // Guardar el PDF firmado
                const pdfBytes = await pdfDoc.save();
                const pdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
                
                // Descargar el PDF
                const signedName = `documento_firmado_${new Date().toISOString().slice(0, 10)}.pdf`;
                download(pdfBlob, signedName, 'application/pdf');
                
                signProgressFill.style.width = '100%';
                
                setTimeout(() => {
                    signProgress.classList.add('hidden');
                }, 500);
                
            } catch (error) {
                console.error('Error al firmar PDF:', error);
                signProgress.classList.add('hidden');
                alert('Ocurri√≥ un error al firmar el PDF. Por favor, verifica que la imagen de firma sea v√°lida.');
            }
        });

        // Funci√≥n auxiliar para formatear tama√±o de archivo
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Inicializar canvas al cargar
        window.addEventListener('load', setupCanvas);
    </script>
<p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px;position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle;display:inline-block;margin-right:3px;filter:brightness(0) invert(1);"><a href="https://enzostvs-deepsite.hf.space" style="color: #fff;text-decoration: underline;" target="_blank" >DeepSite</a> - üß¨ <a href="https://enzostvs-deepsite.hf.space?remix=luzu67/aigde" style="color: #fff;text-decoration: underline;" target="_blank" >Remix</a></p></body>
</html>